import{b as w,O as A,g as f,a as k,c as m,r as x,u as B,m as P,P as y,S as d,W as p}from"./moto1-DEPS2biy.js";import{B as s,a as o}from"./index-BGhFIEda.js";const v=`${w}/engine`;async function C(i,t){return(await fetch(`${v}?id=${i}&status=${t}`,{method:"PATCH"})).json()}async function T(i){try{return await(await fetch(`${v}?id=${i}&status=drive`,{method:"PATCH"})).json()}catch{return{success:!1}}}const S=16,I=2,V=8,g=["Suzuki","BMW","Honda","Yamaha","Harley-Davidson","Stels","Ducati","Can-Am","Moto Guzzi","Derbi"],N=["Limited","Special","Senda","Sport","Cross","Super","Classic","Ultra","King","Deluxe"];function b(i){return Math.floor(Math.random()*i)}function U(){return`${g[b(g.length)]}  ${N[b(N.length)]}`}function D(){return`#${`${Math.random().toString(S)}000000`.substring(I,V)}`}let F=class{saveValues={currentPage:1,values:{name:"",color:""}};carCountStart=0;countIncrement=1;countCarsForRandom=100;carsCount=new A(this.carCountStart);async getCars(t){const e=await f(t);return this.carsCount.notify(Number(e.count)),e.items}async getCar(t){return await k(t)}getCarsCount(){return this.carsCount.getValue()}async createCar(t,e){return m({name:t,color:e}).then(()=>{this.carsCount.notify(a=>a+this.countIncrement)}).catch(()=>{})}async createCars(){const t=Array.from({length:this.countCarsForRandom},()=>m({name:U(),color:D()}));return Promise.all(t).then(()=>{this.carsCount.notify(e=>e+this.countCarsForRandom)})}async removeCar(t){return x(t).then(()=>{this.carsCount.notify(e=>e-this.countIncrement)}).catch(()=>{})}async updateCar(t,e,a){return B(t,{name:e,color:a}).then(()=>{}).catch(()=>{})}};const r=new F;class u extends s{input;constructor({type:t,classNameInput:e,name:a,placeholder:n,value:c,onInput:l}){super({tagName:"input",className:e}),this.input=this.node,l&&this.addListener("input",()=>l(this.getValue())),this.setAttributes(t,a??"",n??"",c??"")}setAttributes(t,e,a,n){this.setAttribute("name",e),this.setAttribute("type",t),a&&this.setAttribute("placeholder",a),n&&(console.log(n),this.setAttribute("value",n.toString()))}getValue(){return this.input.value}setValue(t){this.input.value=t}}class W extends s{constructor(t,e,a){super({tagName:"form",className:"create-form"}),this.onSubmit=t,this.onUpdate=e,this.onRandome=a,this.setAttribute("action",""),this.carName=new u({type:"text",classNameInput:"form-input-name",name:"Name",placeholder:"Input car's name",value:r.saveValues.values.name,onInput:this.inputValueName}),this.color=new u({type:"color",classNameInput:"form-input-color",value:r.saveValues.values.color,onInput:this.inputValueColor}),this.resetForm();const n=new s({tagName:"div",className:"form-input-wrapper"}),c=new s({tagName:"div",className:"form-input-wrapper"});n.appendChildren([this.carName,this.color,this.submit]),c.appendChildren([this.carNameUpdate,this.colorUpdate,this.update]),this.appendChildren([n,c,this.randomGenerate]),this.submitForm(),this.updateForm(),this.randomGenerate.addListener("click",l=>{l.preventDefault(),this.onRandome?.()})}color;carName;submit=new u({type:"submit",classNameInput:"form-input-button",value:"Create"});colorUpdate=new u({type:"color",classNameInput:"form-input-color"});carNameUpdate=new u({type:"text",classNameInput:"form-input-name",name:"Name"});update=new o({className:"form-input-button",textContent:"Update"});randomGenerate=new o({className:"form-input-button random-button",textContent:"Generate random car"});idCar=0;submitForm=()=>{this.submit.addListener("click",t=>{t.preventDefault();const e=this.carName.getValue(),a=this.color.getValue();this.onSubmit?.(e,a),this.carName.setValue(""),this.color.setValue("")})};updateForm=()=>{this.update.addListener("click",t=>{t.preventDefault();const e=this.carNameUpdate.getValue(),a=this.colorUpdate.getValue();this.onUpdate?.(this.idCar,e,a),this.resetForm()})};fullDataOfCar(t){this.carNameUpdate.setValue(t.name),this.carNameUpdate.removeAttribute("disabled"),this.colorUpdate.setValue(t.color),this.idCar=t.id}resetForm(){this.carNameUpdate.setAttribute("disabled","disabled"),this.carNameUpdate.setValue(""),this.colorUpdate.setValue("")}inputValueName=t=>{r.saveValues.values.name=t};inputValueColor=t=>{r.saveValues.values.color=t}}class M extends s{carName;id;name;carImage;constructor(t){super({tagName:"div",className:"car-wrapper-container"}),this.id=t.id,this.name=t.name;const e=new s({tagName:"div",className:"car-wrapper"});this.carName=new s({tagName:"span",className:"car-name",textContent:t.name}),this.carImage=new s({tagName:"div",className:"car-image"}),this.carImage.setHTML(P),this.carImage.setStyle("fill",t.color),e.appendChildren([this.carName,this.carImage]),this.appendChildren([e])}get idCar(){return this.id}get nameCar(){return this.name}startAnimation(t){this.carImage.setStyle("animation","move"),this.carImage.setStyle("animation-duration",t),this.carImage.setStyle("animation-play-state","running"),this.carImage.setStyle("animation-fill-mode","both")}stopAnimation(){this.carImage.deleteStyle("animation")}pauseAnimation(){this.carImage.setStyle("animation-play-state","paused")}}class $ extends s{car;id;updateButton;deleteButton;startButton;stopButton;constructor({currentCar:t,removeCar:e,updateCar:a,startAnimateCar:n,stopAnimateCar:c}){super({tagName:"div",className:"car-track"}),this.id=t.id,this.car=new M(t),this.updateButton=new o({className:"track-button edit-button",textContent:"E",onClick:()=>a(t)}),this.deleteButton=new o({className:"track-button delete-button",textContent:"D",onClick:()=>e(this.id,this)});const l=new s({tagName:"span",className:"controls"});this.startButton=new o({className:"track-button start-button",textContent:"Start",onClick:()=>n(this.car,this.startButton,this.stopButton)}),this.stopButton=new o({className:"track-button stop-button",textContent:"Stop",onClick:()=>c(this.car,this.startButton,this.stopButton)}),this.stopButton.addClass("disabled"),l.appendChildren([this.startButton,this.stopButton]),this.appendChildren([this.updateButton,this.deleteButton,l,this.car])}get carTrack(){return this.car}}class G extends s{modalWrapper=new s({tagName:"div",className:"modal-wrapper"});modalContent=new s({tagName:"div",className:"modal-content"});modalText=new s({tagName:"div",className:"modal-text"});closeButton=new o({className:"modal-button",textContent:"OK"});constructor(){super({tagName:"div",className:"modal"}),this.modalContent.appendChildren([this.modalText,this.closeButton]),this.modalWrapper.appendChildren([this.modalContent]),this.appendChildren([this.modalWrapper]),this.closeButton.addListener("click",()=>{this.modalWrapper.toggleClass("open")})}set content(t){this.modalText.setHTML(t)}toggleModal(){this.modalWrapper.toggleClass("open")}}const L=2;class O extends s{currentPage=r.saveValues.currentPage;countPages=1;header=new s({tagName:"h2",className:"title",textContent:"Garage ()"});pageNumber=new s({tagName:"h3",className:"page-number",textContent:"Page #"});form;tracksContainer=new s({tagName:"div",className:"garage-tracks"});carTracks=[];prevButton=new o({className:"control-button prev-button",textContent:"PREV"});nextButton=new o({className:"control-button next-button",textContent:"NEXT"});raceAll=new o({className:"control-button start-button",textContent:"Start All"});resetAll=new o({className:"control-button stop-button",textContent:"Reset All"});onCarsCountChange;isStop=!1;modal=new G;countMsInSeconds=1e3;constructor(){super({tagName:"div",className:"garage-wrapper"}),this.prevButton.addClass("disabled"),this.resetAll.addClass("disabled");const t=new s({tagName:"div",className:"control-button-wrapper"});t.appendChildren([this.pageNumber,this.prevButton,this.nextButton]),this.form=new W(this.getFormData,this.getFormDataUpdate,this.randomGenerateCars);const e=new s({tagName:"div",className:"wrapper"}),a=new s({tagName:"div",className:"control-race-wrapper"});a.appendChildren([this.raceAll,this.resetAll]),e.appendChildren([this.form,a]),this.onCarsCountChange=n=>{this.header.setTextContent(`Garage (${n})`),this.countPages=Math.ceil(n/y),this.updatePageTitle(),this.checkPrevButton(),this.checkNextButton()},this.createTracks().then(()=>{}).catch(()=>{}),r.carsCount.subscribe(this.onCarsCountChange),this.appendChildren([this.header,t,e,this.tracksContainer,this.modal]),this.nextPage(),this.prevPage(),this.startAllCars(),this.stopAllCars()}nextPage=()=>{this.nextButton.addListener("click",t=>{t.preventDefault(),this.checkNextButton(),this.prevButton.removeClass("disabled"),this.currentPage+=1,r.saveValues.currentPage=this.currentPage,this.updatePageTitle(),this.updateTracks()})};prevPage=()=>{this.prevButton.addListener("click",t=>{t.preventDefault(),this.currentPage===d+1&&this.prevButton.addClass("disabled"),this.nextButton.removeClass("disabled"),this.currentPage-=1,r.saveValues.currentPage=this.currentPage,this.updatePageTitle(),this.updateTracks()})};startAllCars=()=>{this.raceAll.addListener("click",t=>{t.preventDefault(),Promise.any(this.carTracks.map(e=>this.startAnimateCar(e.carTrack,this.raceAll))).then(e=>{this.resetAll.removeClass("disabled"),this.setWinner(e).catch(()=>{})}).catch(()=>{this.resetAll.removeClass("disabled")})})};stopAllCars=()=>{this.resetAll.addListener("click",t=>{t.preventDefault(),Promise.all(this.carTracks.map(e=>this.stopAnimateCar(e.carTrack,this.raceAll,this.resetAll))).then(()=>{}).catch(()=>{})})};checkPrevButton=()=>{this.prevButton.toggleClass("disabled",this.currentPage===d)};checkNextButton=()=>{this.nextButton.toggleClass("disabled",this.currentPage===this.countPages)};async createTracks(){const t=await r.getCars(this.currentPage);this.carTracks=t.map(e=>new $({currentCar:e,removeCar:this.removeCar,updateCar:this.updateCar,startAnimateCar:this.startAnimateCar,stopAnimateCar:this.stopAnimateCar})),this.tracksContainer.appendChildren([...this.carTracks])}updatePageTitle=()=>{this.pageNumber.setTextContent(`Page #${this.currentPage}`)};updateTracks(){this.tracksContainer.destroyChildren(),this.createTracks().then(()=>{}).catch(()=>{}),this.checkNextButton()}getFormData=(t,e)=>{r.createCar(t,e).then(()=>{this.updateTracks()}).catch(()=>{})};getFormDataUpdate=(t,e,a)=>{r.updateCar(t,e,a).then(()=>{this.updateTracks()}).catch(()=>{})};randomGenerateCars=()=>{r.createCars().then(()=>{this.updateTracks()}).catch(()=>{})};removeCar=(t,e)=>{r.removeCar(t).then(()=>{e.destroy(),p.removeWinner(t).then(()=>{}).catch(()=>{})}).catch(()=>{})};updateCar=t=>{this.form.fullDataOfCar(t)};startAnimateCar=async(t,e,a)=>{e?.addClass("disabled"),a?.removeClass("disabled");const{distance:n,velocity:c}=await C(t.idCar,"started");return t.startAnimation(`${n/c}ms`),new Promise(l=>{T(t.idCar).then(h=>{h.success?l({id:t.idCar,name:t.nameCar,time:n/c}):t.pauseAnimation()}).catch(h=>{throw new Error(h)})})};stopAnimateCar=async(t,e,a)=>{e?.removeClass("disabled"),a?.addClass("disabled"),await C(t.idCar,"stopped"),t.stopAnimation()};setWinner(t){const e=(t.time/this.countMsInSeconds).toFixed(L);return this.modal.content=`Первым пришёл водитель ${t.name}. Время ${e} s`,this.modal.toggleModal(),p.createWinner(t.id,Number(e))}}export{O as GaragePage};
